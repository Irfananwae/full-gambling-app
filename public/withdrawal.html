<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <title>Withdraw</title>
</head>
<body>
    <div class="page-container">
        <div class="info-card">
            <h1>Request Withdrawal</h1>
            <p>Your current balance: <b id="balance">--.--</b></p>
            <form id="withdrawal-form">
                <div class="input-group">
                    <input type="number" id="withdraw-amount" placeholder=" " required>
                    <label for="withdraw-amount">Amount to withdraw</label>
                </div>
                <div class="input-group">
                    <input type="text" id="account-holder" placeholder=" " required>
                    <label for="account-holder">Account Holder Name</label>
                </div>
                <div class="input-group">
                    <input type="text" id="bank-account" placeholder=" " required>
                    <label for="bank-account">Bank Account Number</label>
                </div>
                <div class="input-group">
                    <input type="text" id="ifsc-code" placeholder=" " required>
                    <label for="ifsc-code">IFSC Code</label>
                </div>
                <button type="submit">Submit Request</button>
            </form>
            <p id="message" style="margin-top: 15px;"></p>
        </div>
    </div>
    <nav class="footer-nav"></nav>
    <script src="/js/main.js"></script>
    <script>
        if (!token) window.location.href = '/login.html';
        async function fetchWithdrawalPageData(){const r=await fetch('/api/game/balance',{headers:{'x-auth-token':token}});if(r.ok){const d=await r.json();document.getElementById('balance').textContent=`₹${d.balance.toFixed(2)}`;}else{logout();}}
        document.getElementById('withdrawal-form').addEventListener('submit',async e=>{e.preventDefault();const msgEl=document.getElementById('message');msgEl.textContent='Submitting...';const amount=Number(document.getElementById('withdraw-amount').value);const bankDetails={accountHolder:document.getElementById('account-holder').value,accountNumber:document.getElementById('bank-account').value,ifscCode:document.getElementById('ifsc-code').value};const res=await fetch('/api/transaction/request-withdrawal',{method:'POST',headers:{'Content-Type':'application/json','x-auth-token':token},body:JSON.stringify({amount,bankDetails})});const data=await res.json();msgEl.textContent=data.message;if(res.ok){msgEl.style.color='lime';document.getElementById('balance').textContent=`₹${data.newBalance.toFixed(2)}`;e.target.reset();}else{msgEl.style.color='red';}});
        document.addEventListener('DOMContentLoaded',fetchWithdrawalPageData);
    </script>
</body>
</html>
