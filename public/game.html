<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"><link rel="stylesheet" href="style.css"><title>Color Arena</title></head><body>
<div id="flash-overlay"></div><div class="page-container game-page">
    <div class="game-header"><a href="/lobby.html" class="back-btn"><i class="fas fa-arrow-left"></i></a><h1>Color Arena</h1><div class="balance-box"><span id="balance">₹--.--</span></div></div>
    <div class="timer-card"><h3 id="phase-text">Connecting...</h3><div id="countdown-bar-container"><div id="countdown-bar"></div></div></div>
    <div id="result-display"></div>
    <div class="history-bar"><div id="history-dots"></div></div>
    <div class="bet-controls">
        <div class="amount-controls"><input type="number" id="betAmount" placeholder="Bet Amount (Min: 10)" min="10"><div class="quick-bets"><button onclick="setBet(10)">10</button><button onclick="setBet(100)">100</button><button onclick="setBet(500)">500</button><button onclick="setBet(1000)">1k</button></div></div>
        <div class="bet-pads"><div class="bet-pad red" onclick="placeBet('red')"><i class="fas fa-burn"></i><span>RED</span></div><div class="bet-pad green" onclick="placeBet('green')"><i class="fas fa-leaf"></i><span>GREEN</span></div><div class="bet-pad blue" onclick="placeBet('blue')"><i class="fas fa-tint"></i><span>BLUE</span></div></div>
        <p id="message" class="message-box">Place your bet for this round.</p>
    </div>
    <div class="info-card rules-card"><h3><i class="fas fa-book"></i> Game Rules</h3><ul><li>You can place multiple bets on any color during the betting phase.</li><li>Minimum bet amount is ₹10.</li><li>Winning bets pay out at 2x the bet amount.</li><li>Bets placed after the timer ends will be for the next round.</li></ul></div>
</div>
<script src="/socket.io/socket.io.js"></script><script src="/js/main.js"></script>
<script>
    // This is the new, complete JS for the advanced Color Arena
    if(!token)window.location.href='/login.html';const socket=io();const balanceEl=document.getElementById('balance');const msgEl=document.getElementById('message');const betInput=document.getElementById('betAmount');const betPads=document.querySelectorAll('.bet-pad');const phaseEl=document.getElementById('phase-text');const resultEl=document.getElementById('result-display');const historyEl=document.getElementById('history-dots');const countdownBar=document.getElementById('countdown-bar');const flashOverlay=document.getElementById('flash-overlay');socket.on('connect',()=>{socket.emit('authenticate',token);});socket.on('gameState',state=>{const percentage=(state.timer/(state.phase==='betting'?15:5))*100;countdownBar.style.width=`${percentage}%`;countdownBar.className=state.phase;if(state.phase==='betting'){phaseEl.innerHTML=`BETTING ENDS IN: <span class="timer-glow">${state.timer}s</span>`;resultEl.innerHTML='';betPads.forEach(p=>p.classList.remove('disabled'));}else if(state.phase==='result'){phaseEl.textContent=`RESULT IN: ${state.timer}s`;betPads.forEach(p=>p.classList.add('disabled'));if(!resultEl.innerHTML){resultEl.innerHTML=`<div class="result-text">${state.winningColor.toUpperCase()}</div>`;flashColor(state.winningColor);}}let historyHtml='';state.history.forEach(color=>{historyHtml+=`<div class="history-dot ${color}"></div>`;});historyEl.innerHTML=historyHtml;});socket.on('balanceUpdate',data=>{balanceEl.textContent=`₹${data.newBalance.toFixed(2)}`;balanceEl.classList.add('highlight');setTimeout(()=>balanceEl.classList.remove('highlight'),500);});async function fetchBalance(){const r=await fetch('/api/game/balance',{headers:{'x-auth-token':token}});if(r.ok){const d=await r.json();balanceEl.textContent=`₹${d.balance.toFixed(2)}`;}}
    async function placeBet(color){const amount=Number(betInput.value);if(!amount||amount<10){msgEl.textContent='Minimum bet is ₹10.';msgEl.style.color='red';return;}betPads.forEach(p=>p.classList.add('pending'));msgEl.textContent=`Placing bet...`;const r=await fetch('/api/game/play-color-game',{method:'POST',headers:{'Content-Type':'application/json','x-auth-token':token},body:JSON.stringify({betAmount:amount,chosenColor:color})});const d=await r.json();betPads.forEach(p=>p.classList.remove('pending'));if(r.ok){msgEl.textContent=d.message;msgEl.style.color='lime';balanceEl.textContent=`₹${d.newBalance.toFixed(2)}`;}else{msgEl.textContent=d.message;msgEl.style.color='red';}}
    function setBet(amount){betInput.value=amount;}function flashColor(color){flashOverlay.style.backgroundColor=color;flashOverlay.classList.add('active');setTimeout(()=>flashOverlay.classList.remove('active'),500);}document.addEventListener('DOMContentLoaded',fetchBalance);
</script></body></html>
