<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <title>Color Prediction Game</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .game-info { font-size: 1.5em; font-weight: bold; }
        .timer { color: #66fcf1; }
        .result { text-transform: uppercase; animation: popIn 0.5s; }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        .bot-bets { margin-top: 20px; text-align: left; max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px;}
        .bot-bet { display: flex; justify-content: space-between; }
        .bot-bet .red { color: #dc3545; }
        .bot-bet .green { color: #28a745; }
        .bot-bet .blue { color: #007bff; }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Color Prediction</h1>
        <p>Balance: <b id="balance">...</b></p>
        
        <div class="game-info">
            <span id="phase">Connecting to game...</span>
            <span id="timer" class="timer">--</span>
        </div>

        <div class="result-display" id="resultDisplay" style="min-height: 30px;"></div>

        <input type="number" id="betAmount" placeholder="Enter bet amount" min="1">
        <div class="color-buttons">
            <button class="color-btn" style="background: #dc3545;" onclick="play('red')">RED</button>
            <button class="color-btn" style="background: #28a745;" onclick="play('green')">GREEN</button>
            <button class="color-btn" style="background: #007bff;" onclick="play('blue')">BLUE</button>
        </div>
        <p id="message"></p>

        <div class="bot-bets">
            <h3>Live Bets</h3>
            <div id="botBetsList"></div>
        </div>

        <a href="/lobby.html">Back to Lobby</a>
    </div>

    <!-- Socket.IO client library -->
    <script src="/socket.io/socket.io.js"></script>

    <script>
        const token = localStorage.getItem('authToken');
        if (!token) window.location.href = '/login.html';

        // Initialize Socket.IO connection
        const socket = io();

        const balanceEl = document.getElementById('balance');
        const messageEl = document.getElementById('message');
        const betInput = document.getElementById('betAmount');
        const colorButtons = document.querySelectorAll('.color-btn');
        const timerEl = document.getElementById('timer');
        const phaseEl = document.getElementById('phase');
        const resultDisplayEl = document.getElementById('resultDisplay');
        const botBetsListEl = document.getElementById('botBetsList');

        // Listen for game state updates from the server
        socket.on('gameState', (state) => {
            timerEl.textContent = state.timer;
            resultDisplayEl.innerHTML = ''; // Clear previous result

            if (state.phase === 'betting') {
                phaseEl.textContent = 'Place Your Bet!';
                setButtonsDisabled(false);
                messageEl.textContent = '';
                
                // Display AI bot bets
                let botsHtml = '';
                state.bots.forEach(bot => {
                    botsHtml += `<div class="bot-bet"><span>${bot.name}</span><span class="${bot.color}">â‚¹${bot.bet} on ${bot.color}</span></div>`;
                });
                botBetsListEl.innerHTML = botsHtml;

            } else if (state.phase === 'result') {
                phaseEl.textContent = 'Round Result!';
                setButtonsDisabled(true);
                resultDisplayEl.innerHTML = `<span class="result" style="color:${state.winningColor};">Winner is ${state.winningColor}!</span>`;
            }
        });

        function setButtonsDisabled(disabled) {
            colorButtons.forEach(b => b.disabled = disabled);
        }

        async function fetchBalance() {
            // ... (rest of the script is the same as before) ...
        }

        // The 'play' function remains the same, it still sends a POST request to the API
        async function play(chosenColor) {
           // ... (this function is identical to the previous version) ...
        }
        
        document.addEventListener('DOMContentLoaded', fetchBalance);
    </script>
</body>
</html>
