<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <title>Aviator X</title>
</head>
<body class="aviator-body">
    <!-- Animated Starfield Background -->
    <div class="stars"></div>

    <div class="aviator-page">
        <!-- Header can be added here if needed, but we hide it for full-screen feel -->
        <div class="aviator-history-bar" id="aviator-history"></div>
        <div class="aviator-graph-container">
            <canvas id="aviator-canvas"></canvas>
            <div id="aviator-plane">
                <!-- Sleek SVG Plane -->
                <svg viewBox="0 0 512 512" xml:space="preserve"><path d="M473.1,43.1c-22.9-22.9-57.5-28.5-85.8-17.3L53.4,171.4c-21.5,8.5-35.3,29.3-35.3,52.2V416c0,23.5,15.2,44.7,37.6,51l44.3,12.5c19.4,5.5,39.5-2.2,51.8-19.1l84-118.1c12.2-17.1,38.3-17.1,50.4,0l84,118.1c12.3,16.9,32.4,24.6,51.8,19.1l44.3-12.5c22.4-6.3,37.6-27.5,37.6-51V128.9C501.7,100.6,496,66,473.1,43.1z"/></svg>
            </div>
            <div id="aviator-multiplier">1.00x</div>
        </div>
        <div class="bet-panels">
            <!-- Bet Panel 1 -->
            <div class="bet-panel" id="panel1"><div class="amount-controls"><div class="amount-input-wrapper"><button class="adjust-btn">-</button><input class="bet-input" type="number" value="10" min="10"><button class="adjust-btn">+</button></div><div class="quick-bets"><button class="quick-bet-btn">100</button><button class="quick-bet-btn">200</button><button class="quick-bet-btn">500</button><button class="quick-bet-btn">1000</button></div></div><button class="bet-btn">BET</button></div>
            <!-- Bet Panel 2 -->
            <div class="bet-panel" id="panel2"><div class="amount-controls"><div class="amount-input-wrapper"><button class="adjust-btn">-</button><input class="bet-input" type="number" value="10" min="10"><button class="adjust-btn">+</button></div><div class="quick-bets"><button class="quick-bet-btn">100</button><button class="quick-bet-btn">200</button><button class="quick-bet-btn">500</button><button class="quick-bet-btn">1000</button></div></div><button class="bet-btn">BET</button></div>
        </div>
        <!-- Live Bets Feed (can be added here) -->
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/main.js"></script>
    <script>
        if (!token) window.location.href = '/login.html';
        const socket = io();
        socket.on('connect', () => socket.emit('authenticate', token));

        const multiplierEl = document.getElementById('aviator-multiplier');
        const planeEl = document.getElementById('aviator-plane');
        const canvas = document.getElementById('aviator-canvas'), ctx = canvas.getContext('2d');
        let currentMultiplier = 1.00, pathPoints = [], animationFrameId;

        const panels = {
            panel1: { id: 'panel1', el: document.getElementById('panel1'), input: document.querySelector('#panel1 .bet-input'), btn: document.querySelector('#panel1 .bet-btn'), state: 'idle', betAmount: 0 },
            panel2: { id: 'panel2', el: document.getElementById('panel2'), input: document.querySelector('#panel2 .bet-input'), btn: document.querySelector('#panel2 .bet-btn'), state: 'idle', betAmount: 0 }
        };

        function resizeCanvas() { canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();

        function drawPath() {
            const w = canvas.width, h = canvas.height;
            const planeX = (currentMultiplier - 1) * (w / 15);
            const planeY = h - Math.pow(planeX / w, 0.6) * h * 0.9 - 25;
            
            const prevPoint = pathPoints[pathPoints.length - 1] || [0, h];
            const angle = Math.atan2(planeY - prevPoint[1], planeX - prevPoint[0]);
            planeEl.style.transform = `translate(${planeX}px, ${planeY}px) rotate(${angle + Math.PI / 2}rad)`;

            ctx.clearRect(0, 0, w, h);
            pathPoints.push([planeX, planeY]);
            
            ctx.strokeStyle = '#ff5555';
            ctx.lineWidth = 4;
            ctx.shadowColor = '#ff5555';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.moveTo(pathPoints[0][0], pathPoints[0][1]);
            for (let i = 1; i < pathPoints.length; i++) ctx.lineTo(pathPoints[i][0], pathPoints[i][1]);
            ctx.stroke();
        }

        socket.on('aviatorState', (state) => {
            if (state.phase === 'waiting') {
                const waitTime = Math.ceil((state.startTime - Date.now()) / 1000);
                multiplierEl.innerHTML = `<div>Starting in ${waitTime > 0 ? waitTime : 0}s</div>`;
                multiplierEl.className = 'waiting'; planeEl.style.display = 'none'; pathPoints = [];
                Object.values(panels).forEach(p => updatePanelUI(p, 'idle'));
                updateHistory(state.history);
            } else if (state.phase === 'playing') {
                planeEl.style.display = 'block'; multiplierEl.className = 'playing';
                multiplierEl.textContent = `${state.multiplier.toFixed(2)}x`;
                currentMultiplier = state.multiplier;
                Object.values(panels).forEach(p => { if (p.state === 'waiting_for_round') updatePanelUI(p, 'in_game'); });
                drawPath();
            } else if (state.phase === 'crashed') {
                multiplierEl.className = 'crashed';
                multiplierEl.innerHTML = `<span class="flew-away-text">FLEW AWAY!</span>${state.multiplier.toFixed(2)}x`;
                planeEl.style.display = 'none';
                Object.values(panels).forEach(p => { if (p.state === 'in_game') updatePanelUI(p, 'idle'); });
            }
        });

        function updatePanelUI(panel, newState) {
            panel.state = newState;
            const controlsDisabled = newState !== 'idle';
            panel.input.disabled = controlsDisabled;
            panel.el.querySelectorAll('.adjust-btn, .quick-bet-btn').forEach(b => b.disabled = controlsDisabled);
            switch(newState) {
                case 'idle': panel.btn.textContent = `BET (₹${panel.input.value})`; panel.btn.className = 'bet-btn'; break;
                case 'waiting_for_round': panel.btn.textContent = 'WAITING...'; panel.btn.className = 'bet-btn waiting'; break;
                case 'in_game': panel.btn.textContent = `CASH OUT ₹${(panel.betAmount * currentMultiplier).toFixed(2)}`; panel.btn.className = 'bet-btn cashout'; break;
                case 'cashed_out': panel.btn.textContent = `CASHED OUT`; panel.btn.className = 'bet-btn cashed-out'; panel.btn.disabled = true; break;
            }
        }
        
        Object.values(panels).forEach(panel => {
            const betBtn = panel.btn, input = panel.input;
            betBtn.onclick = () => { /* Bet/Cashout logic is the same as before */ };
            input.oninput = () => { if(panel.state === 'idle') betBtn.textContent = `BET (₹${input.value})`; };
            // ... all other panel event listeners are the same ...
        });

        function updateHistory(history) { /* Render history items is the same */ }
        // ... balance update and initial fetch logic is the same ...
    </script>
</body>
</html>
